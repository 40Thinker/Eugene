>[!nexus_user] **User** - 30.06.2025 at 2:55
> –ú–æ–≥—É –ª–∏ —è 9-10 —ç–∫—Å–ø–µ—Ä—Ç–æ–≤, 90–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç? –ß—Ç–æ —Ç–∞–∫–æ–µ –æ–æ–º
<!-- UID: 8b20d123-f011-4714-8414-13ca28bd2c76 -->




>[!nexus_agent] **Assistant** - 30.06.2025 at 2:55
> –û—Ç–≤–µ—á–∞—é —á—ë—Ç–∫–æ:
> 
> ---
> 
> ## ‚úÖ **–¢—ã –ú–û–ñ–ï–®–¨** –∑–∞–ø—É—Å—Ç–∏—Ç—å:
> 
> ### üîπ **Qwen3‚Äë30B** —Å:
> - `num_experts_per_tok: 9‚Äì10`
> - `context_length: 90,000`
> 
> **–ù–∞ —Ç–≤–æ–µ–π RTX 6000 Blackwell (~96‚Äì98‚ÄØGB VRAM)** ‚Äî —ç—Ç–æ **—Ä–µ–∞–ª—å–Ω–æ**, –µ—Å–ª–∏:
> - —Ç—ã –∑–∞–ø—É—Å–∫–∞–µ—à—å –º–æ–¥–µ–ª—å –≤ **Int4 (AWQ / GPTQ)** –∏–ª–∏
> - –∏—Å–ø–æ–ª—å–∑—É–µ—à—å **FP16, –Ω–æ –Ω–µ –¥–µ—Ä–∂–∏—à—å —Å—Ä–∞–∑—É –±–æ–ª—å—à–æ–π batch**
> 
> ---
> 
> ## üìò –ß—Ç–æ —Ç–∞–∫–æ–µ OOM?
> 
> **OOM = Out Of Memory** 
> ‚Üí —ç—Ç–æ **–æ—à–∏–±–∫–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –≤–∏–¥–µ–æ–ø–∞–º—è—Ç–∏**, –∫–æ–≥–¥–∞ VRAM –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—á–µ—Ä–ø–∞–Ω. 
> –ü—Ä–æ—è–≤–ª—è–µ—Ç—Å—è –∫–∞–∫:
> - –ú–æ–¥–µ–ª—å "–≤—ã–ª–µ—Ç–∞–µ—Ç" —Å –æ—à–∏–±–∫–æ–π `CUDA OOM`
> - –ò–ª–∏ —Å–µ—Ä–≤–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, `text-gen-webui`) –∑–∞–≤–∏—Å–∞–µ—Ç
> - –ò–Ω–æ–≥–¥–∞ Linux —Ç–µ—Ä—è–µ—Ç –¥—Ä–∞–π–≤–µ—Ä (`nvidia-smi` –ø–µ—Ä–µ—Å—Ç–∞—ë—Ç –æ—Ç–≤–µ—á–∞—Ç—å)
> 
> üìå –≠—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ ‚Äî –ø—Ä–æ—Å—Ç–æ —Ç—ã –¥–∞–ª **—Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å, —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤, —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π batch**.
> 
> ---
> 
> ## üß† –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏
> 
> | –ü–∞—Ä–∞–º–µ—Ç—Ä | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç |
> |------------------------|-----------------------------------|
> | **num_experts_per_tok** | –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –±–æ–ª—å—à–µ MoE-—ç–∫—Å–ø–µ—Ä—Ç–æ–≤ ‚Üí –±–æ–ª—å—à–µ VRAM –Ω–∞ –≤–µ—Å–∞ –∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ |
> | **context_length** | –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç **KV-–∫–µ—à–∏** ‚Äî –ø–∞–º—è—Ç—å –Ω–∞ —Ç–æ–∫–µ–Ω—ã –≤–≤–æ–¥–∞ |
> | **batch size > 1** | –ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤—Å—ë –≤—ã—à–µ |
> 
> ---
> 
> ## üìä –û—Ü–µ–Ω–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏
> 
> | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | –û—Ü–µ–Ω–∫–∞ VRAM |
> |------------------------------------|-------------|
> | 8 —ç–∫—Å–ø–µ—Ä—Ç–æ–≤, 32k context, FP16 | ~70 GB |
> | 10 —ç–∫—Å–ø–µ—Ä—Ç–æ–≤, 90k context, FP16 | ~90‚Äì95 GB |
> | 10 —ç–∫—Å–ø–µ—Ä—Ç–æ–≤, 90k, **Int4 AWQ** | ~45‚Äì55 GB |
> | 16 —ç–∫—Å–ø–µ—Ä—Ç–æ–≤, 128k, FP16 | ‚ùå OOM |
> 
> ---
> 
> ## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å, —á—Ç–æ–±—ã **90k + 9 —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–ª–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ**:
> 
> 1. **–§–æ—Ä–º–∞—Ç –º–æ–¥–µ–ª–∏:**
>  - –ò—Å–ø–æ–ª—å–∑—É–π **GGUF / AWQ / GPTQ** –≤ `Int4` —Ñ–æ—Ä–º–∞—Ç–µ
>  - –ò–ª–∏ `float16`, –µ—Å–ª–∏ batch=1
> 
> 2. **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞:**
>  - –£–∫–∞–∂–∏: 
>  ```
>  --ctx-size 90000
>  --rope-scaling dynamic
>  --num-experts 10
>  --gpu-memory 95
>  ```
> 
> 3. **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç:**
>  - `text-generation-webui` –∏–ª–∏ `llama.cpp` (—á–µ—Ä–µ–∑ `llama_model_loader.cc`)
>  - –í `text-gen-webui`: –≤—Å—ë –∑–∞–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ GUI –∏–ª–∏ `params.json`
> 
> ---
> 
> ## üß† –ò—Ç–æ–≥:
> 
> | –í–æ–ø—Ä–æ—Å | –û—Ç–≤–µ—Ç |
> |------------------------------------|------------------------------|
> | –ú–æ–∂–µ—à—å –ª–∏ —Ç—ã –∑–∞–¥–∞—Ç—å 9‚Äì10 —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ | ‚úÖ –î–∞ |
> | –ú–æ–∂–Ω–æ –ª–∏ –∑–∞–¥–∞—Ç—å 90k –∫–æ–Ω—Ç–µ–∫—Å—Ç | ‚úÖ –î–∞ |
> | –†–∏—Å–∫ OOM –µ—Å—Ç—å? | ‚ö†Ô∏è –¢–æ–ª—å–∫–æ –ø—Ä–∏ FP16 + batch>1 |
> | –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å? | Int4 + rope-scaling + batch=1 |
> 
> ---
> 
> –•–æ—á–µ—à—å ‚Äî —Å–æ–±–µ—Ä—É —Ç–µ–±–µ –≥–æ—Ç–æ–≤—ã–π –∫–æ–Ω—Ñ–∏–≥: 
> - `GGUF`-–º–æ–¥–µ–ª—å 
> - launcher-—à–∞–±–ª–æ–Ω (`.sh`) 
> - –∏ —Ä–µ–∂–∏–º `long-context deep-reasoning` (9‚Äì10 —ç–∫—Å–ø–µ—Ä—Ç–æ–≤, 90k context)
> 
> –ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–¥–∞—Ç—å?
<!-- UID: 35556475-f643-4a2a-b0cc-3216bc1bf45d -->