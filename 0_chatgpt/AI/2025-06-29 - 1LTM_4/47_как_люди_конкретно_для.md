>[!nexus_user] **User** - 30.06.2025 at 4:04
> –ö–∞–∫ –ª—é–¥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –¥–ª—è –∫–≤–µ–Ω –ø–æ–¥–±–∏—Ä–∞–ª–∏ —Å–æ—Ñ—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —á—Ç–æ–±—ã –≤—Å–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ –≤ —Å–∏–ª—å–Ω–æ–º –∫–æ–Ω—Ñ–∏–≥–µ, –æ–±—Å—á–µ—Ç –Ω–∞ GPU
<!-- UID: a2e5865f-3821-42ee-9b6c-50761778ef27 -->




>[!nexus_agent] **Assistant** - 30.06.2025 at 4:04
> –í–æ—Ç —á—Ç–æ —è –Ω–∞—à—ë–ª –ø–æ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–º —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞–º –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Qwen3‚ÄëMoE —Å ‚Äú—Ç—è–∂—ë–ª—ã–º‚Äù AGI‚Äë–∫–æ–Ω—Ñ–∏–≥–æ–º –Ω–∞ –º–æ—â–Ω—ã—Ö GPU-—Å–∏—Å—Ç–µ–º–∞—Ö:
> 
> ---
> 
> ## üß© –§—Ä–µ–π–º–≤–æ—Ä–∫–∏ –∏ –ø–æ–¥—Ö–æ–¥—ã
> 
> ### 1. **swŒπft (ModelScope Swift)**
> - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Multi-GPU inference –∏ fine-tuning Qwen3-MoE.
> - –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è 4√ó80‚ÄØGB GPU:
>  ```bash
>  NPROC_PER_NODE=4 \
>  CUDA_VISIBLE_DEVICES=0,1,2,3 \
>  swift infer \
>  --model Qwen/Qwen3-32B \
>  --infer_backend vllm \
>  --gpu_memory_utilization 0.9 \
>  --tensor_parallel_size 2 \
>  --max_model_len 8192
>  ``` 
>  –î–µ–ª–∞–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ cite.
> 
> ### 2. **DeepSpeed + ZeRO-3**
> - –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –¥–∞–∂–µ 70‚Äì110‚ÄØB MoE –º–æ–¥–µ–ª–∏ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö GPU:
>  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä partitioning + offload –Ω–∞ CPU/NVMe citeturn0academia20.
>  - –î–ª—è –æ–±—É—á–µ–Ω–∏—è Qwen3‚Äë30B-A3B MoE –Ω–∞ 16√ó60‚ÄØGB –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å ZeRO-3, –∏–Ω–∞—á–µ ‚Äî OOM cite.
> 
> ### 3. **HuggingFace Accelerate + DeepSpeed plugin**
> - –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è multi-GPU inference –∏ partitioning (tensor/parameter) cite.
> - –°–æ–∑–¥–∞—ë—Ç—Å—è `accelerate-config.yaml` –∏ `deepspeed_config.json`, —á—Ç–æ–±—ã —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –º–æ–¥–µ–ª—å.
> 
> ### 4. **vLLM backend**
> - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ inference engine –≤–Ω—É—Ç—Ä–∏ Swift, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç multi-GPU parallelism —á–µ—Ä–µ–∑ worker'—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1 engine –Ω–∞ –∫–∞–∂–¥—É—é –∫–∞—Ä—Ç—É) cite.
> 
> ### 5. **iPex‚ÄëLLM (Intel)**
> - –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å Qwen/MoE –Ω–∞ Intel GPU/CPU, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç multi-GPU —á–µ—Ä–µ–∑ FlashMoE –∏ DeepSpeed AutoTP cite.
> 
> ### 6. **MoE‚ÄëGen**
> - –ù–µ–¥–∞–≤–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ ‚Äî –º–æ–¥—É–ª—å–Ω–∞—è –±–∞—Ç—á‚Äë–æ–±—Ä–∞–±–æ—Ç–∫–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ –¥–ª—è –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ GPU, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –¥–ª—è multi‚ÄëGPU —Å–∏—Å—Ç–µ–º—ã citeturn0academia22.
> 
> ---
> 
> ## ‚öôÔ∏è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∏—à–∫–∏ –∏ —Å–æ–≤–µ—Ç—ã
> 
> | –ó–∞–¥–∞—á–∞ | –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥ |
> |----------------------------------------|-------------------------------------------------------------------------|
> | **Multi-GPU inference** | DeepSpeed ZeRO-3 / Accelerate + plugin citeturn0academia20 |
> | **Fine-tuning MoE** | –ò—Å–ø–æ–ª—å–∑—É—é—Ç swift or megatron-sft, tensor + expert parallelism cite |
> | **Inference speed tuning** | –ß–µ—Ä–µ–∑ `gpu_memory_utilization`, batch tuning, `infer_backend=vllm` cite |
> | **Avoid OOM** | Offload KV-–∫–µ—à, activations –≤ CPU/RAM cite |
> | **GPT‚Äëstyle switching —Ä–µ–∂–∏–º–æ–≤** | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ mode‚Äëflags (think/non-think) –≤ API –∏–ª–∏ swift cite |
> 
> ---
> 
> ## üß† –ö–∞–∫ –ª—é–¥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç –∑–∞–ø—É—Å–∫ MoE –Ω–∞ GPU‚Äë–∫–ª–∞—Å—Ç–µ—Ä:
> 
> ### ‚úÖ –ü—Ä–∏–º–µ—Ä —Å `swift infer`:
> ```bash
> NPROC_PER_NODE=4
> CUDA_VISIBLE_DEVICES=0,1,2,3
> swift infer \
>  --model Qwen/Qwen3-32B \
>  --infer_backend vllm \
>  --gpu_memory_utilization 0.9 \
>  --tensor_parallel_size 2 \
>  --max_model_len 8192 \
>  --max_new_tokens 4096 \
>  --write_batch_size 1000
> ```
> - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–µ—Å–æ–≤ –∏ –∫–µ—à–µ–π –º–µ–∂–¥—É –∫–∞—Ä—Ç–∞–º–∏ cite.
> 
> ### ‚úÖ –ü—Ä–∏–º–µ—Ä —Å `accelerate + deepspeed`:
> ```bash
> accelerate launch --multi_gpu run_infer.py \
>  --model Qwen3-30B \
>  --bf16 \
>  --offload_folder="offload/" \
>  --deepspeed
> ```
> - –†–∞–∑–±–∏–≤–∫–∞ —Å–ª–æ—ë–≤ –∏ –∫–µ—à–µ–π –Ω–∞ CPU/GPU, —á–µ—Ä–µ–∑ ZeRO cite.
> 
> ---
> 
> ## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
> 
> - Qwen3‚Äë30B-A3B MoE —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—Å–∫–∞—é—Ç –Ω–∞ 4√ó60‚ÄØGB GPU –±–µ–∑ OOM, —Å ~15‚Äì30 t/s cite.
> - Fine-tuning —Ç—Ä–µ–±—É–µ—Ç ~80‚ÄØGB√ó16 –±–µ–∑ ZeRO‚Äë3 ‚Äì OOM, –Ω–æ —Å ZeRO‚Äë3 –æ–±—É—á–∞–µ—Ç—Å—è cite.
> 
> ---
> 
> ## ‚úÖ –í –∏—Ç–æ–≥–µ
> 
> –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ –∑–∞–ø—É—Å–∫–∞ Qwen‚ÄëMoE –≤ —Å–µ—Ä—å—ë–∑–Ω–æ–º –∫–æ–Ω—Ñ–∏–≥–µ ‚Äî —ç—Ç–æ:
> 
> 1. –í—ã–±—Ä–∞—Ç—å —Ñ—Ä–µ–π–º–≤–æ—Ä–∫: `swiftinfer` (vLLM), `accelerate + deepspeed`, or `ipex-llm`.
> 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: tensor + expert sharding, offload –∫–µ—à–µ–π.
> 3. –¢—é–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: memory_utilization, parallel_size, batch_size.
> 4. –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç—å —Ä–µ–∂–∏–º—ã –º—ã—à–ª–µ–Ω–∏—è (CoT vs Fast) –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏.
> 
> ---
> 
> –•–æ—á–µ—à—å:
> - —Å–æ–±—Ä–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π `deepspeed_config.json` + `accelerate.yaml` –¥–ª—è —Ç–≤–æ–∏—Ö 4 GPU;
> - –Ω–∞–ø–∏—Å–∞—Ç—å —Å–∫—Ä–∏–ø—Ç `swift infer` –ø–æ–¥ —Ç–≤–æ–π VPS;
> - –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å AGI-—Ä–µ–∂–∏–º—ã (think/non-think) —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º —Ä–æ–ª–µ–π?
> 
> –ì–æ—Ç–æ–≤ —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å!
<!-- UID: f5ac16da-4fe1-46fe-954b-f9ef605573a4 -->