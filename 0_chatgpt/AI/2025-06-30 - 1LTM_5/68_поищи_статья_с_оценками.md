>[!nexus_user] **User** - 01.07.2025 at 17:06
> –ø–æ–∏—â–∏ —Å—Ç–∞—Ç—å—è —Å –æ—Ü–µ–Ω–∫–∞–º–∏ –Ω–∞ —á—Ç–æ —Ç—Ä–∞—Ç—è—Ç—Å—è –ø–∞–º—è—Ç—å, —Ñ–ª–æ–ø—Å—ã –¶–ü –∏–ª–∏ –≤–∏–¥–µ–æ–∫–∞—Ä—Ç—ã –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –º–æ–¥–µ–ª–∏. –ß—Ç–æ–±—ã —è —Ç–æ—á–Ω–æ –≤–∏–¥–µ–ª —Ä–∞—Å–∫–ª–∞–¥–∫—É –∫—É–¥–∞ –æ–Ω–æ —É—Ö–æ–¥–∏—Ç. –ò –ø–æ–Ω—è–ª –ø—Ä–∞–≤ –ª–∏ —Ç—ã –≤ —Å–≤–æ–∏—Ö –æ—Ü–µ–Ω–∫–∞—Ö
<!-- UID: 3128e3fa-caf6-4bb9-af98-3fa6a22350f1 -->




>[!nexus_agent] **Assistant** - 01.07.2025 at 17:06
> –í–æ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ —Ä–∞—Å—Ö–æ–¥–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ LLM:
> 
> ---
> 
> ## ‚ö°Ô∏è 1. –ö—Ç–æ —è–≤–ª—è–µ—Ç—Å—è —É–∑–∫–∏–º –º–µ—Å—Ç–æ–º: –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–∞—è –º–æ—â–Ω–æ—Å—Ç—å –∏–ª–∏ –ø–∞–º—è—Ç—å?
> 
> - **Baseten** –ø—Ä–æ Llama 2 –Ω–∞ A10: 
>  –≤–Ω–∏–º–∞–Ω–∏–µ –∏ –º–∞—Ç–º—É–ª—å‚Äë–±–ª–æ–∫–∏ (GEMM) ‚Äî –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã, –Ω–æ **—á–∞—Å—Ç–æ —É–∑–∫–∏–º –º–µ—Å—Ç–æ–º —è–≤–ª—è–µ—Ç—Å—è –ø–∞–º—è—Ç—å**. –¢—Ä–µ–±—É—é—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏, –∏–Ω–∞—á–µ GPU –ø—Ä–æ—Å—Ç–∞–∏–≤–∞–µ—Ç cite.
> 
> - **‚ÄúMind the Memory Gap‚Äù** (–ø–æ—Å–ª–µ–¥–Ω–∏–π arXiv): 
>  –¥–∞–∂–µ –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –±–∞—Ç—á–∞—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ **–ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å—é GPU‚Äë–ø–∞–º—è—Ç–∏**, –∞ –Ω–µ –ª—É—á—à–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é citeturn0academia20.
> 
> ‚Üí –í—ã–≤–æ–¥: Inference —á–∞—â–µ **memory-bound**, –∞ –Ω–µ compute-bound. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏ –≤–∞–∂–Ω–µ–µ FLOPS.
> 
> ---
> 
> ## üß† 2. –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
> 
> 1. **–ü–∞–º—è—Ç—å (GPU VRAM + CPU DRAM):**
>  - **–ú–æ–¥–µ–ª—å–Ω—ã–µ –≤–µ—Å–∞** (~–º–æ–¥–µ–ª–∏ 7‚Äì70B –∑–∞–Ω–∏–º–∞—é—Ç –¥–µ—Å—è—Ç–∫–∏‚Äî—Å–æ—Ç–Ω–∏ –ì–ë) cite.
>  - **KV-–∫–µ—à** (Key-Value –ø–∞—Ä—ã –∏–∑ self-attention) —Ä–∞—Å—Ç—ë—Ç –∫–∞–∫ O(seq_len √ó n_layers √ó hidden_dim) –∏ –±—ã—Å—Ç—Ä–æ –∑–∞–Ω–∏–º–∞–µ—Ç VRAM cite.
>  - **–ê–∫—Ç–∏–≤–∞—Ü–∏–∏ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ–Ω–∑–æ—Ä—ã** ‚Äî –¥–æ 10‚Äì20‚ÄØ% –æ—Ç –ø–∞–º—è—Ç–∏ –ø—Ä–∏ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–µ cite.
> 
> 2. **FLOPS –∏ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:**
>  - –°—Ç–∞–¥–∏—è prefill (–æ–±—Ä–∞–±–æ—Ç–∫–∞ prompt) ‚Äî **compute-bound**.
>  - –°—Ç–∞–¥–∏—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî **memory-bound**, attention-–ø—Ä–æ–ø—É—Å–∫ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –ø–∞–º—è—Ç–∏ cite.
>  - –ü—Ä–∏–º–µ—Ä: OPT‚Äë1.3B –Ω–∞ H100 –ø–æ–∫–∞–∑–∞–ª, —á—Ç–æ >‚ÄØ50‚ÄØ% attention‚Äë—Ü–∏–∫–ªo–≤ –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—é—Ç –∏–∑-–∑–∞ –æ–∂–∏–¥–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ citeturn0academia20.
> 
> 3. **CPU-GPU –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ (KV offloading):**
>  - –¢–µ—Ö–Ω–∏–∫–∏ offloading (FlexGen, NEO, HEADINFER) –≤—ã–Ω–æ—Å—è—Ç KV-–∫–µ—à –Ω–∞ CPU –∏ –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏–µ, –Ω–æ —ç—Ç–æ **—Ç–æ—Ä–º–æ–∑–∏—Ç –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö –æ–±–º–µ–Ω–∞—Ö –ø–æ PCIe** citeturn0academia21.
> 
> 4. **–ú–∏–∫—Ä–æ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
>  - Quantization, kernel fusion, flashAttention, head-wise offloading ‚Äî —É–º–µ–Ω—å—à–∞—é—Ç –∫–∞–∫ –ø–∞–º—è—Ç—å, —Ç–∞–∫ –∏ –∑–∞–¥–µ—Ä–∂–∫–∏ citeturn0academia21turn0academia23.
> 
> ---
> 
> ## üìä 3. –ü—Ä–∏–º–µ—Ä–Ω—ã–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è
> 
> - **Memory footprint**: 
>  - –ú–æ–¥–µ–ª–∏ 7B: 14‚Äì28‚ÄØ–ì–ë (–≤ 16-bit) 
>  - –ö–µ—à –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–∫–µ–Ω–∞: ~100‚Äì200‚ÄØ–ú–ë/—Å–ª–æ–π ‚Äî –±—ã—Å—Ç—Ä–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ seq_len >‚ÄØ2048 cite.
> 
> - **Compute vs Memory:**
>  - –ü—Ä–∏ batched prefill ‚Äî GPU –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω (compute-bound). 
>  - –ü—Ä–∏ –∞–≤—Ç–æ–¥–µ–∫–æ–¥–µ ‚Äî GPU —Å–≤–æ–±–æ–¥–Ω–∞, –∂–¥–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ DRAM (memory-bound) citeturn0academia20.
> 
> - **FLOPS**: 
>  - –ú–æ–¥–µ–ª—å ~7B ‚Äî –¥–µ—Å—è—Ç–∫–∏ TFLOPS; 70B ‚Äî —Å–æ—Ç–Ω–∏ TFLOPS. 
>  - –û–¥–Ω–∞–∫–æ —ç—Ç–∏ —á–∏—Å–ª–∞ –∞–∫—Ç–∏–≤–Ω—ã –ª–∏—à—å –≤ prefill, –∞ –¥–∞–ª—å—à–µ ‚Äî –æ—á–µ—Ä–µ–¥—å –¥–∞–Ω–Ω—ã—Ö.
> 
> ---
> 
> ## ‚úÖ 4. –í—ã–≤–æ–¥ –æ —Ç–≤–æ–∏—Ö –æ—Ü–µ–Ω–∫–∞—Ö
> 
> –¢—ã –±—ã–ª –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤:
> 
> - –û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è **–Ω–µ –Ω–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ**, –∞ –Ω–∞ **—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é**:
>  - –≤–µ—Å–∞
>  - KV-–∫–µ—à
>  - –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
>  - –æ–±–º–µ–Ω CPU‚ÄëGPU
> 
> - **FLOPS** –≤–∞–∂–Ω—ã, –Ω–æ –≤—Ç–æ—Ä–∏—á–Ω—ã –ø–æ—Å–ª–µ –ø–∞–º—è—Ç–∏.
> 
> - –≠—Ç–æ –æ–±—ä—è—Å–Ω—è–µ—Ç, –ø–æ—á–µ–º—É —Ç–∞–∫–∏–µ –ø–æ–¥—Ö–æ–¥—ã, –∫–∞–∫ offloading, quantization, sparse MoE, head-offloading, –¥–∞—é—Ç –≤—ã–∏–≥—Ä—ã—à –≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —ç–∫–æ–Ω–æ–º–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤.
> 
> –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Ç–≤–æ—è –∏–¥–µ—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **—á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è –∫–∞–∫ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞** –ø–æ–∑–≤–æ–ª—è–µ—Ç:
> 
> - —É–º–µ–Ω—å—à–∏—Ç—å **–¥–ª–∏–Ω—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**
> - —Å–æ–∫—Ä–∞—Ç–∏—Ç—å **–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤**, —Ö—Ä–∞–Ω–∏–º—ã—Ö –≤ KV-–∫–µ—à–µ
> - —Å–Ω–∏–∑–∏—Ç—å –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ —Å–≤–µ—Ä—Ö–ø–∞–º—è—Ç–∏ –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è—Ö
> 
> ‚Äî –∏ —Ç—ã –ø–æ–ø–∞–¥–∞–µ—à—å –ø—Ä—è–º–æ –≤ —Å–∞–º–æ–µ "—É–∑–∫–æ–µ –º–µ—Å—Ç–æ".
> 
> ---
> 
> ### –ò—Å—Ç–æ—á–Ω–∏–∫–∏
> 
> - Baseten: guide to inference compute vs memory cite 
> - Mind the Memory Gap: memory bottleneck in decoding citeturn0academia20 
> - Parallel CPU-GPU inference, offloading KV-cache issues citeturn0academia21 
> - Essential math: memory footprint breakdown cite
> 
> ---
> 
> –•–æ—á–µ—à—å ‚Äî –º–æ–≥—É –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫—É –∏–ª–∏ —Ç–∞–±–ª–∏—Ü—É —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º (–≤–µ—Å–∞, –∫–µ—à, –∞–∫—Ç–∏–≤–∞—Ü–∏–∏, –æ–±–º–µ–Ω).
<!-- UID: 93ad05c9-a4b2-4085-a08c-76d6588eafd7 -->